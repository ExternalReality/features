machine:
  timezone:
    America/New_York

  ruby:
    version: 2.3.0

  hosts:
    circlehost: 127.0.0.1
    dev.features.com: 127.0.0.1

dependencies:
  pre:
    - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 575159689BEFB442
    - echo 'deb http://download.fpcomplete.com/ubuntu precise main'| sudo tee /etc/apt/sources.list.d/fpco.list
    - sudo apt-get update && sudo apt-get install stack -y
    - wget https://bintray.com/artifact/download/business/maven/flyway-commandline-3.2.1-linux-x64.tar.gz
    - tar -xvf flyway-commandline-3.2.1-linux-x64.tar.gz
    - export PATH={$HOME}/flyway-commandline-3.2.1:$PATH

  cache_directories:
    - /home/ubuntu/.stack

  override:
    - stack setup
    - stack install
    - bundle install:
        timeout: 180
    
database:
  pre:
    - createdb features
    - flyway migrate

test:
  override:
    - stack build features
    - stack exec features
    - rspec
